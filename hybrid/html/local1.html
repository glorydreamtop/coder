<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta content="telephone=no" name="format-detection" />
		<meta content="email=no" name="format-detection" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<script src="./js/jquery.min.js"></script>
		<script type="text/javascript" src="https://js.cdn.aliyun.dcloud.net.cn/dev/uni-app/uni.webview.1.5.2.js"></script>
		<script type="text/javascript" src="./js/mescroll.min.js" charset="utf-8"></script>
		<script type="text/javascript" src="./js/functions.js"></script>
		<link href="./css/juejin.css" rel="stylesheet" type="text/css" />
		<link href="./css/article.css" rel="stylesheet" type="text/css" />
		<link href="./css/icon.css" rel="stylesheet" type="text/css" />
		<link href="./css/mescroll.min.css" rel="stylesheet" type="text/css" />
		<title>文章详情</title>
	</head>
	<body>
		<div id="article_app" class="article-content">
		</div>
		<div id="coder_mask" class="coder_hidden" onclick="maskHidden()">
		</div>
		<div id="coder_popup" class="coder_hidden">
			<div class="coder_title">
				收藏夹
			</div>
			<div class="coder_list" id="coder_list">

			</div>
		</div>
		<div id="coder_comments" class="coder_hidden ">
			<div id="coder_comments_inner" class="mescroll">
				<div id="coder_comments_innerList">

				</div>
			</div>
		</div>
	</body>

	<script type="text/javascript">
		$(document).ready(() => {
			// 上次请求接口的最后一条创建时间
			let lastCreatedAt = '';
			let commentsList = [];
			const params = window.location.search.substring(1);
			
			//隐藏弹窗和遮罩
			const maskHidden = () => {
				const idMap = ['#coder_mask', '#coder_popup', '#coder_comments'];
				idMap.forEach(item => {
					$(item).toggleClass('coder_hidden');
				})
				mescroll.hideTopBtn();
				return;
			}
			// 获取文章详情
			const getDetail = () => {
				const detailUrl = 'https://post-storage-api-ms.juejin.im/v1/getDetailData';
				document.addEventListener('plusready', function() {
					const xhr = new plus.net.XMLHttpRequest();
					xhr.open("GET", `${detailUrl}?${params}`);
					xhr.send();
					xhr.onload = () => {
						$('#article_app').html(JSON.parse(xhr.responseText).d.content);
					}
				}, false);
			}
			// 外部唤醒评论列表弹窗
			const wakeUpComments = (headers) => {
				if ($('#coder_comments').hasClass('coder_show')) return;
				const idMap = ['#coder_mask', '#coder_comments'];
				idMap.forEach(item => {
					$(item).toggleClass('coder_show');
				})
				if (commentsList.length !== 0) return;
				getComments(headers);
			}
			getDetail();
		})
	</script>
</html>
